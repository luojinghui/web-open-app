<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="apple-itunes-app" content="app-id=1058254032">
    <title>test unverserl link</title>
    <style>
      .mui-input {
        box-sizing: border-box;
        padding: 7px 10px;
        line-height: 18px;
        height: 38px;
        border: 1px solid #CFCFCF;
        color: #595959;
        border-radius: 4px;
        font-size: 14px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      .input100 {
        width: 100%;
      }
    </style>

    <script src="//cdn.bootcss.com/eruda/1.1.3/eruda.min.js"></script>
    <script>eruda.init();</script>
  </head>

  <body>
    <a href="#" id="openapp">测试OpenApp插件打开App</a>
    <hr>
    <a href="https://www.luojh.com/joinroom">打开app</a>
    <hr>
    <a href="https://www.luojh.com/openapp">打开app</a>
    <hr>
    <a href="xylink://openapp">secheme打开app</a>
    <hr>
    <a href="https://a.app.qq.com/o/simple.jsp?pkgname=com.ainemo.dragoon">yingyongbao</a>
    <hr>
    <a
      href="intent://com.xylink.push/notify_detail#Intent;scheme=hwpush;package=com.ainemo.dragoon.dev;launchFlags=0x10000000;end">android
      intent app</a>
    <hr>
    <!-- href="intent://com.xylink.push/notify_detail#Intent;package=com.ainemo.dragoon.dev;scheme=hwpush;S.browser_fallback_url=https%3A%2F%2Fwww.baidu.com;end;">android -->
    <a
      href="intent://com.xylink.push/notify_detail#Intent;package=com.ainemo.dragoon.dev;scheme=hwpush;S.browser_fallback_url=https%3A%2F%2Fdevcdn.xylink.com%2FminiProgram%2Fulink%2Fulink.html%3Fentry%3Dintent;end;">android
      intent app222</a>
    <hr>
    <a target="_blank" href="itms-apps://itunes.apple.com/app/id1058254032">itunes</a>
    <hr>
    <div>
      <a target="_blank" href="https://itunes.apple.com/cn/app/wei/id1058254032">appstore</a>
    </div>
    <hr>
    <div class="buttom">
      <a href="#" onclick="onFocusInput()">click</button>
    </div>
    <hr>
    <div>
      <input class="mui-input input100" id="input" placeholder="" type="text">
    </div>
    <hr>
    <div>

    </div>

    <!-- <script src="https://unpkg.com/callapp-lib@2.1.8/dist/index.umd.min.js"></script> -->

    <!-- <script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script> -->
    <script>

      console.log('test33...');

      var u = navigator.userAgent;
      var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1;   //判断是否是 android终端
      var isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
      var chrome = window.navigator.userAgent.indexOf("Chrome") || -1;
      var isChrome = chrome > 0;

      var isWeixin = function () { //判断是否是微信
        var ua = navigator.userAgent.toLowerCase();

        return ua.match(/MicroMessenger/i) == "micromessenger";
      };

      // var wechatInfo = navigator.userAgent.match(/MicroMessenger\/([\d\.]+)/i) || [];
      // var wechatVersion = (wechatInfo && wechatInfo[1]) || 0;

      function getQueryString(name) {
        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
      }
    </script>

    <script src="./lib/index.js?random=15121"></script>
    <script>
      var openapp;

      window.onload = function () {
        (async () => {
          let listOfInstalledApps = await navigator.getInstalledRelatedApps();
          console.log("listOfInstalledApps", listOfInstalledApps)
        })()

        openapp = new OpenApp({
          scheme: "xylink://openapp",
          intent: "intent://com.xylink.push/notify_detail#Intent;package=com.ainemo.dragoon.dev;scheme=hwpush;S.browser_fallback_url=https%3A%2F%2Fdevcdn.xylink.com%2FminiProgram%2Fulink%2Fulink.html%3Fentry%3Dintent;end;",
          applink: "https://www.luojh.com/openapp",
          copyText: "number: " + Math.ceil(Math.random() * 10000),
          callback: function (status, msg) {
            console.log("status: ", status, "  msg2: ", msg);
          }
        })

        // if (openapp.systemInfo.isAndroid || !(openapp.systemInfo.isWeixin || openapp.systemInfo.isIOS)) {
        //   openapp.open();
        // }

        document.getElementById("openapp").addEventListener("click", function () {
          openapp.open();
        })

        document.getElementById("test").addEventListener("click", function () {
          window.location.href = "xylink://openapp";
          setTimeout(function () { window.location = 'https://itunes.apple.com/cn/app/wei/id1058254032' }, 50);
        })
      }

      function onFocusInput() {
        // <input class="mui-input input100" id="input" placeholder="" readonly="" autocomplete="off" type="text" style="opacity: 0; position: fixed; top: 0; left: 0; width: 1px; height: 1px">

        // const iframe = document.createElement('iframe');

        // iframe.setAttribute('src', url);
        // iframe.setAttribute('style', 'display:none');

        // document.body.appendChild(iframe);
        // setTimeout(function () {
        //   document.body.removeChild(iframe);
        // }, 300);


        // var input = document.getElementById("input");

        // input.addEventListener("focus", function (e) {
        //   console.log("input focus: ", e);
        //   setInterval(() => {
        //     console.log("---------");
        //   }, 1000);
        // })
        // input.addEventListener("blur", function (e) {
        //   console.log("input blur: ", e);
        // })

        // input.focus();

        // const input = document.createElement('input');
        const input = document.getElementById('input');
        let timmer = null;
        let isInputTimeout = false;
        const onFocus = function (e) {
          console.log('input focus: ', e);
          timmer = setInterval(() => {
            console.log('---------');
          }, 1000);
        };
        const onBlur = function (e) {
          console.log('input blur333: ', e);
          if (!isInputTimeout) {
            console.log('input blur: ', e);
            haveChange = true;
            isHaveApp = true;
          }
        };

        // input.setAttribute('id', 'input');
        // input.setAttribute('readonly', '');
        // input.setAttribute('autocomplete', 'off');
        // input.setAttribute('type', 'text');
        // input.setAttribute('class', 'mui-input input100');
        // // input.setAttribute('style', 'opacity: 0; position: fixed; top: 0; left: 0px; width: 1px; height: 1px');
        // document.body.appendChild(input);

        input.addEventListener('focus', onFocus);
        input.addEventListener('blur', onBlur);

        input.focus();

        setTimeout(function () {
          isInputTimeout = true;

          input.removeEventListener('focus', onFocus);
          input.removeEventListener('blur', onFocus);
          clearInterval(timmer);
          console.log("超时。。");

          input.remove();
        }, 8000);


        // input.select();
        // input.setSelectionRange(0, input.value.length);
        // document.execCommand('copy');

        window.location.href = "xylink://openapp";
      }
    </script>

    <script>
      // window.onload = function () {
      //   const options = {
      //     scheme: {
      //       protocol: "xylink",
      //       host: "com.xylink.push"
      //     },
      //     intent: {
      //       package: "com.ainemo.dragoon.dev",
      //       scheme: "hwpush"
      //     },
      //     // universal: {
      //     //   host: "https://www.luojh.com",
      //     //   pathKey: "openapp"
      //     // },
      //     appstore: "https://itunes.apple.com/cn/app/wei/id1058254032",
      //     yingyongbao: "https://a.app.qq.com/o/simple.jsp?pkgname=com.ainemo.dragoon",
      //     timeout: 2000,
      //     fallback: "https://devcdn.xylink.com/miniProgram/ulink/ulink.html?111=1"
      //   };
      //   const callLib = new CallApp(options);

      //   if (isWeixin && isIOS && getQueryString("entry") === "redirect") {
      //     // window.location.href = "itms-apps://itunes.apple.com/app/id1058254032";
      //     window.location.href = "https://itunes.apple.com/cn/app/wei/id1058254032";
      //     return;
      //   }

      //   if (getQueryString("entry") === "redirect" && isIOS) {
      //     // window.location.href = "itms-apps://itunes.apple.com/app/id1058254032";
      //     window.location.href = "https://itunes.apple.com/cn/app/wei/id1058254032";
      //     return;
      //   }

      //   if (isIOS) {
      //     // window.location.href = "https://itunes.apple.com/cn/app/wei/id1058254032";
      //     return;
      //   }

      //   if (isAndroid && getQueryString("entry") === "intent" && !isWeixin) {

      //     callLib.open({
      //       // android
      //       path: 'notify_detail',

      //       // ios
      //       // path: 'openapp',
      //       callback: function () {

      //       }
      //     });

      //     return;
      //   }

      //   if (isAndroid && isChrome) {
      //     window.location.href = "xylink://openapp";
      //     // callLib.open({
      //     //   // android
      //     //   path: 'notify_detail',

      //     //   // ios
      //     //   // path: 'openapp',
      //     //   callback: function() {

      //     //   }
      //     // });          
      //   }
      // }
    </script>
  </body>

</html>